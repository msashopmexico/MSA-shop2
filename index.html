<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MSA Shop México</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>MSA Shop México</h1>
    <div class="header-buttons">
      <button id="btn-login">Iniciar Sesión</button>
      <button id="btn-logout" style="display:none;">Cerrar Sesión</button>
      <button onclick="window.location.href='carrito.html'">🛒 Carrito</button>
    </div>
  </header>

  <div class="container">
    <div class="producto">
      <h2>Camiseta Custom</h2>
      <img src="img/camisetaLisaNegra.png" alt="Camiseta Custom">
      <p>Sube tu diseño y crea tu propia camiseta personalizada.</p>
      <p><strong>$300 MXN</strong></p>
      <button id="btn-agregar" class="agregar">Agregar al carrito</button>
    </div>
  </div>

  <!-- Modal selección de talla -->
  <div id="modal-talla" class="modal">
    <div class="modal-content">
      <h3>Selecciona tu talla</h3>
      <div class="tallas">
        <button onclick="seleccionarTalla('S')">S</button>
        <button onclick="seleccionarTalla('M')">M</button>
        <button onclick="seleccionarTalla('L')">L</button>
        <button onclick="seleccionarTalla('XL')">XL</button>
        <button onclick="seleccionarTalla('XXL')">XXL</button>
      </div>
      <button onclick="cerrarModal()">Cancelar</button>
    </div>
  </div>

  <!-- Panda en la esquina -->
  <div class="panda-bg"></div>

  <!-- Auth0 SPA JS -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.26/auth0-spa-js.production.js"></script>

  <script>
    // ==== Variables globales ====
    let auth0 = null;
    let productoSeleccionado = { nombre: "Camiseta Custom", precio: 300 };

    // ==== Funciones Auth0 ====
    window.onload = async () => {
      auth0 = await window.createAuth0Client({
        domain: 'dev-r83h8xsmacihkvil.us.auth0.com',
        client_id: 'PBGnUOmoUjfuTJwwpW6bHIQDSSDGPjQf',
        cacheLocation: 'localstorage'
      });

      const isAuthenticated = await auth0.isAuthenticated();

      if (isAuthenticated) {
        document.getElementById("btn-login").style.display = "none";
        document.getElementById("btn-logout").style.display = "inline-block";
      } else {
        document.getElementById("btn-login").style.display = "inline-block";
        document.getElementById("btn-logout").style.display = "none";
      }
    };

    document.getElementById("btn-login").addEventListener("click", async () => {
      await auth0.loginWithRedirect({ redirect_uri: window.location.href });
    });

    document.getElementById("btn-logout").addEventListener("click", async () => {
      await auth0.logout({ returnTo: window.location.href });
    });

    // ==== Funciones Carrito ====
    document.getElementById("btn-agregar").addEventListener("click", async () => {
      const isAuthenticated = await auth0.isAuthenticated();
      if (!isAuthenticated) {
        alert("Debes iniciar sesión para comprar");
        return;
      }
      document.getElementById("modal-talla").style.display = "flex";
    });

    function seleccionarTalla(talla) {
      productoSeleccionado.talla = talla;
      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      carrito.push(productoSeleccionado);
      localStorage.setItem("carrito", JSON.stringify(carrito));
      document.getElementById("modal-talla").style.display = "none";
      window.location.href = "upload.html"; // Ir a subir imagen
    }

    function cerrarModal() {
      document.getElementById("modal-talla").style.display = "none";
    }
  </script>
</body>
</html>

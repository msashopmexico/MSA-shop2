<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSA Shop MÃ©xico</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>MSA Shop MÃ©xico</h1>
  <div class="header-buttons">
    <button id="login-btn">Iniciar SesiÃ³n</button>
    <button id="register-btn">Registrarse</button>
    <button id="carrito-btn">ðŸ›’ Carrito</button>
  </div>
</header>

<div class="container">
  <div class="producto">
    <h2>Camiseta Custom</h2>
    <img src="img/camisetaLisaNegra.png" alt="Camiseta Custom">
    <p>Sube tu diseÃ±o y crea tu propia camiseta personalizada.</p>
    <p><strong>$300 MXN</strong></p>
    <button id="btn-agregar" class="agregar">Agregar al carrito</button>
  </div>
</div>

<div id="modal-talla" class="modal">
  <div class="modal-content">
    <h3>Selecciona tu talla</h3>
    <div class="tallas">
      <button onclick="seleccionarTalla('S')">S</button>
      <button onclick="seleccionarTalla('M')">M</button>
      <button onclick="seleccionarTalla('L')">L</button>
      <button onclick="seleccionarTalla('XL')">XL</button>
      <button onclick="seleccionarTalla('XXL')">XXL</button>
    </div>
    <button onclick="cerrarModal()">Cancelar</button>
  </div>
</div>

<script type="module">
import { createAuth0Client } from "https://cdn.jsdelivr.net/npm/@auth0/auth0-spa-js@2.0.0/dist/auth0-spa-js.production.js";

let auth0 = null;
let user = null;
let productoSeleccionado = { nombre: "Camiseta Custom", precio: 300 };

// Inicializar Auth0
async function initAuth() {
  auth0 = await createAuth0Client({
    domain: import.meta.env.AUTH0_DOMAIN,
    client_id: import.meta.env.AUTH0_CLIENT_ID,
    audience: import.meta.env.AUTH0_AUDIENCE
  });

  if (await auth0.isAuthenticated()) {
    user = await auth0.getUser();
  }
}
initAuth();

// Botones login/register
document.getElementById("login-btn").addEventListener("click", () => {
  auth0.loginWithRedirect({ redirect_uri: window.location.href });
});

document.getElementById("register-btn").addEventListener("click", () => {
  auth0.loginWithRedirect({ screen_hint: "signup", redirect_uri: window.location.href });
});

// Agregar al carrito
const modal = document.getElementById("modal-talla");
document.getElementById("btn-agregar").addEventListener("click", async () => {
  if (!auth0 || !(await auth0.isAuthenticated())) {
    alert("Debes iniciar sesiÃ³n para agregar productos.");
    return;
  }
  modal.style.display = "flex";
});

function seleccionarTalla(talla) {
  productoSeleccionado.talla = talla;
  let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
  carrito.push(productoSeleccionado);
  localStorage.setItem("carrito", JSON.stringify(carrito));
  modal.style.display = "none";
  window.location.href = "upload.html";
}

function cerrarModal() { modal.style.display = "none"; }
</script>
</body>
</html>

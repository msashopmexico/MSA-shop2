<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subir Dise√±o - MSA Shop</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>Sube tu dise√±o</h1>
  <div class="header-buttons">
    <button onclick="window.location.href='index.html'">Inicio</button>
    <button onclick="window.location.href='carrito.html'">üõí Carrito</button>
  </div>
</header>

<div class="container">
  <input type="file" id="fileInput" accept="image/png, image/jpeg" />
  <div id="preview" style="margin-top:20px;"></div>
  <button id="enviar-btn" class="agregar">Enviar Pedido</button>
</div>

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
emailjs.init('PhV4Hp36EPOLiGe6t');

const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
let selectedFile = null;

fileInput.addEventListener("change", (e)=>{
  const file = e.target.files[0];
  if(file && /image\/(png|jpeg|jpg)/.test(file.type)){
    selectedFile = file;
    const reader = new FileReader();
    reader.onload = function(e){
      preview.innerHTML = `<img src="${e.target.result}" style="max-width:300px;border-radius:12px;"/>`;
    };
    reader.readAsDataURL(file);
  } else {
    alert("Solo se permiten PNG, JPG o JPEG");
  }
});

document.getElementById("enviar-btn").addEventListener("click", ()=>{
  if(!selectedFile){
    alert("Debes seleccionar un archivo");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e){
    const imgData = e.target.result;
    emailjs.send("service_4450mrz","template_biyacaa",{
      nombre: "Cliente",
      fecha: new Date().toLocaleString(),
      productos: "Camiseta Custom",
      total: "$300",
      email: "cliente@ejemplo.com",
      linkImagen: imgData
    }).then(()=>{
      alert("‚úÖ Pedido enviado correctamente, revisa tu correo");
      window.location.href="index.html";
    }, (err)=>{
      console.error(err);
      alert("‚ùå Error al enviar el pedido");
    });
  };
  reader.readAsDataURL(selectedFile);
});
</script>
</body>
</html>

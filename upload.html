<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subir diseño - MSA Shop</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>Sube tu diseño</h1>
  <div class="header-buttons">
    <button onclick="window.location.href='index.html'">Inicio</button>
    <button onclick="window.location.href='carrito.html'">Carrito</button>
  </div>
</header>

<div class="container">
  <div class="producto">
    <h2>Preview de tu diseño</h2>
    <div id="preview-container">
      <img id="preview" src="" alt="Preview" style="max-width:300px; display:none;"/>
    </div>
    <input type="file" id="file-input" accept="image/png,image/jpeg">
    <button id="upload-btn">Enviar diseño</button>
  </div>
</div>

<script type="module">
import emailjs from "https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js";

emailjs.init('PhV4Hp36EPOLiGe6t');

const fileInput = document.getElementById("file-input");
const preview = document.getElementById("preview");

fileInput.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function() { preview.src = reader.result; preview.style.display = "block"; }
  reader.readAsDataURL(file);
});

document.getElementById("upload-btn").addEventListener("click", async () => {
  const file = fileInput.files[0];
  if (!file) { alert("Selecciona un archivo."); return; }

  const formData = new FormData();
  formData.append("file", file);

  try {
    await emailjs.send("service_4450mrz","template_biyacaa",{
      nombre: "Cliente",
      email: "cliente@correo.com",
      productos: JSON.stringify(localStorage.getItem("carrito")),
      link_diseno: preview.src
    });
    alert("✅ Diseño enviado correctamente!");
  } catch(e) { console.error(e); alert("❌ Error al enviar el diseño."); }
});
</script>
</body>
</html>
